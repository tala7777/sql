https://app.diagrams.net/?src=about#G1LwLbPVcL-CU1LTSCSg8xibjCatDauILK#%7B%22pageId%22%3A%22SiBahVIFnq9635iZXtUm%22%7D;
https://drawsql.app/teams/ss-327/diagrams/task1;
CREATE DATABASE ecommerce_db;
USE ecommerce_db;

CREATE TABLE users (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    user_name VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    phone VARCHAR(20),
    date_of_birth DATE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50)
);

CREATE TABLE address (
    address_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    country VARCHAR(100),
    city VARCHAR(100),
    street VARCHAR(150),
    apt_no BIGINT,
    zip_code BIGINT,
    FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);

CREATE TABLE categories (
    category_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    category_name VARCHAR(100) NOT NULL,
    products_number INT,
    category_description TEXT
);

CREATE TABLE products (
    product_id INT AUTO_INCREMENT PRIMARY KEY,
    category_id BIGINT,
    product_name VARCHAR(150) NOT NULL,
    quantity INT,
    product_description TEXT,
    price DECIMAL(10,2),
    status VARCHAR(50),
    FOREIGN KEY (category_id)
        REFERENCES categories(category_id)
        ON DELETE SET NULL
);

CREATE TABLE orders (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    address_id BIGINT NOT NULL,
    total_price DECIMAL(10,2),
    order_status VARCHAR(50),
    FOREIGN KEY (user_id)
        REFERENCES users(user_id),
    FOREIGN KEY (address_id)
        REFERENCES address(address_id)
);

CREATE TABLE order_items (
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT,
    price_per_one DECIMAL(10,2),
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (order_id)
        REFERENCES orders(order_id)
        ON DELETE CASCADE,
    FOREIGN KEY (product_id)
        REFERENCES products(product_id)
);

CREATE TABLE payment (
    receipt_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    order_id INT NOT NULL,
    payment_method VARCHAR(50),
    FOREIGN KEY (user_id)
        REFERENCES users(user_id),
    FOREIGN KEY (order_id)
        REFERENCES orders(order_id)
        ON DELETE CASCADE
);

CREATE TABLE credit_cards_info (
    card_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    card_number VARCHAR(30),
    card_first_name VARCHAR(100),
    card_last_name VARCHAR(100),
    card_expire_date VARCHAR(10),
    card_cvv VARCHAR(10),
    FOREIGN KEY (user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);
-- Insert sample users
INSERT INTO users (user_name, email, phone, date_of_birth, password, role)
VALUES
('Nader Ahmad', 'nader@example.com', '0791234567', '2002-05-20', 'hashedpassword1', 'customer'),
('Lina Saleh', 'lina@example.com', '0799876543', '2001-11-15', 'hashedpassword2', 'customer'),
('Admin User', 'admin@example.com', '0791112222', '1995-01-01', 'hashedpassword3', 'admin');

-- Insert sample addresses for users
INSERT INTO address (user_id, country, city, street, apt_no, zip_code)
VALUES
(1, 'Jordan', 'Amman', 'Rainbow Street', '12A', '11118'),
(2, 'Jordan', 'Zarqa', 'King Abdullah Street', '5B', '20234');

-- Insert sample product categories
INSERT INTO categories (category_name, products_number, category_description)
VALUES
('Electronics', 3, 'All kinds of electronic devices'),
('Clothing', 2, 'Men and women apparel');

-- Insert sample products
INSERT INTO products (category_id, product_name, quantity, product_description, price, status)
VALUES
(1, 'iPhone 15', 50, 'Latest Apple iPhone', 1200.00, 'available'),
(1, 'Samsung TV 55"', 20, 'Smart LED TV', 700.00, 'available'),
(1, 'Headphones', 100, 'Noise-cancelling headphones', 150.00, 'available'),
(2, 'Men T-Shirt', 200, 'Cotton T-Shirt', 25.00, 'available'),
(2, 'Women Dress', 150, 'Summer dress', 40.00, 'available');

-- Insert sample orders
INSERT INTO orders (user_id, address_id, total_price, order_status)
VALUES
(1, 1, 1400.00, 'pending'),
(2, 2, 65.00, 'completed');

-- Insert order items for each order
INSERT INTO order_items (order_id, product_id, quantity, price_per_one)
VALUES
(1, 1, 1, 1200.00),
(1, 3, 2, 100.00),
(2, 4, 1, 25.00),
(2, 5, 1, 40.00);

-- Insert payment records
INSERT INTO payment (user_id, order_id, payment_method)
VALUES
(1, 1, 'Credit Card'),
(2, 2, 'Cash on Delivery');

-- Insert credit card information for users
INSERT INTO credit_cards_info (user_id, card_number, card_first_name, card_last_name, card_expire_date, card_cvv)
VALUES
(1, '4111111111111111', 'Nader', 'Ahmad', '12/27', '123'),
(2, '5500000000000004', 'Lina', 'Saleh', '09/26', '456');

-- Retrieve all products
SELECT * FROM products;

-- Retrieve all users
SELECT * FROM users;

-- Retrieve orders with related user information using JOIN
SELECT 
    orders.order_id,
    users.user_name,
    users.email,
    orders.total_price,
    orders.order_status
FROM orders
JOIN users ON orders.user_id = users.user_id;

-- Retrieve orders with related user and address information
SELECT 
    orders.order_id,
    users.user_name,
    address.city,
    address.street,
    orders.total_price,
    orders.order_status
FROM orders
JOIN users ON orders.user_id = users.user_id
JOIN address ON orders.address_id = address.address_id;

-- Retrieve products cheaper than $200
SELECT product_name, price
FROM products
WHERE price < 200;

-- Retrieve orders with status 'pending'
SELECT order_id, user_id, total_price
FROM orders
WHERE order_status = 'pending';

-- Retrieve products sorted by price ascending
SELECT product_name, price
FROM products
ORDER BY price ASC;

-- Retrieve users sorted by name descending
SELECT user_name, email
FROM users
ORDER BY user_name DESC;

-- Retrieve first 5 users
SELECT user_id, user_name
FROM users
LIMIT 5;

-- Count total number of orders
SELECT COUNT(*) AS total_orders
FROM orders;

-- Sum total sales amount
SELECT SUM(total_price) AS total_sales
FROM orders;

-- Retrieve orders with user info using INNER JOIN
SELECT 
    orders.order_id,
    users.user_name,
    orders.total_price,
    orders.order_status
FROM orders
INNER JOIN users 
    ON orders.user_id = users.user_id;

-- Retrieve all users and their orders using LEFT JOIN (optional relationship)
SELECT 
    users.user_name,
    orders.order_id,
    orders.total_price
FROM users
LEFT JOIN orders 
    ON users.user_id = orders.user_id;

